// Mapeamento das URLs das casas de apostas baseado no nome retornado pela API
export const bookmakerUrls = {
  // Casas de apostas principais - URLs atualizadas
  BFSportsbook: "https://www.betfair.bet.br/apostas/",
  "Bet365.bet.br": "https://www.bet365.bet.br/",
  Bet7k: "https://7k.bet.br/",
  BetFast: "https://betfast.bet.br/",
  BetNacional: "https://www.betnacional.bet.br/",
  "Betano.bet.br": "https://www.betano.bet.br/",
  Betfair: "https://www.betfair.bet.br/",
  BetssonBR: "https://www.betsson.com/",
  "Blaze.bet.br": "https://blaze.bet.br/",
  EstrelabetBR: "https://www.estrelabet.bet.br/",
  "Kto.bet.br": "https://www.kto.bet.br/",
  "Novibet.bet.br": "https://www.novibet.bet.br/",
  "Pinnacle.bet.br": "https://www.pinnacle.com/",
  Sbobet: "https://www.sbobet.com/",
  "Sportingbet.bet.br": "https://www.sportingbet.bet.br/",
  "Superbet.bet.br": "https://superbet.bet.br/",
  TonyBet: "https://tonybet.com/",
  Vbet: "https://www.vbet.com/",

  // Casas de apostas nacionais
  Pixbet: "https://pixbet.bet.br/",
  Bateubet: "https://bateu.bet.br/",
  VeraBet: "https://vera.bet.br/sports",
  ApostaTudo: "https://apostatudo.bet.br/sports",
  BetDaSorte: "https://betdasorte.bet.br/sports/",
  BetGorillas: "https://betgorillas.bet.br/sports",
  BetBuffalos: "https://betbuffalos.bet.br/sports",
  BetFalcons: "https://betfalcons.bet.br/sports",
  SorteNaBet: "https://sortenabet.bet.br/sports",
  ApostaMax: "https://apostamax.bet.br/sports",
  RicoBet: "https://rico.bet.br/sports",
  B2XBet: "https://b2x.bet.br/sports",
  BullsBet: "https://bullsbet.bet.br/sports",
  JogÃ£o: "https://jogao.bet.br/sports",
  DonaldBet: "https://donald.bet.br/sports",
  BetPontoBet: "https://betpontobet.bet.br/sports",
  BetFusion: "https://betfusion.bet.br/sports",
  Betou: "https://betou.bet.br/sports?sportId=1",
  BetAki: "https://betaki.bet.br/sportsbook",
  Betboo: "https://www.betboo.bet.br/pt-br/sports/ao-vivo/aposta",
  TivoBet: "https://tivo.bet.br/br/sportsbook/live",
  Faz1Bet: "https://faz1.bet.br/br/sportsbook/live#/live/overview",
  "9F": "https://9f.bet.br/br/web/sports",
  "6R": "https://6r.bet.br/sports",
  BetApp: "https://betapp.bet.br/br/web/sports",
  P9: "https://p9.bet.br/sports",
  "9D": "https://9d.bet.br/br/web/sports",
  WjCasino: "https://wjcasino.bet.br/br/web/sports",
  "10Game": "https://10.game/br/web/sports",
  "Stake Br": "https://stake.bet.br/esportes",
  Betmgm: "https://www.betmgm.bet.br/aposta-esportiva#featured",
  Betwarrior: "https://apostas.betwarrior.bet.br/pt-br/sports/home",
  JonBet: "https://jonbet.bet.br/pt/sports?bt-path=%2Flive",
  BetVip: "https://betvip.bet.br/sports",
  Rivalry: "https://www.rivalry.com/pt/esports",
  SorteOnline: "https://www.sorteonline.bet.br/aposta-esportiva?page=overview",
  Lottoland: "https://www.lottoland.bet.br/aposta-esportiva?page=overview",
  BR4: "https://br4.bet.br/sports#/overview",
  GolDeBet: "https://goldebet.bet.br/sports#/overview",
  LotoGreen: "https://lotogreen.bet.br/sports#/overview",
  EsportivaBet: "https://esportiva.bet.br/sports",
  JogoDeOuro: "https://jogodeouro.bet.br/pt/sports",
  McGames: "https://mcgames.bet.br/sports#/overview",
  MultiBet: "https://multi.bet.br/sports#/overview",
  BateuBet: "https://bateu.bet.br/sports#/overview",
  Aposta1: "https://www.aposta1.bet.br/esportes#/overview",
  CassinoBet: "https://cassino.bet.br/sports#/overview",
  Pagol: "https://pagol.bet.br/br/aposta-esportiva/overview",
  "7Games":
    "https://7games.bet.br/pb/sports/pre-match/event-view/Soccer/World/18277589",
  BetÃ£o:
    "https://betao.bet.br/pb/sports/pre-match/event-view/Soccer/World/10579",
  R7: "https://r7.bet.br/pb/sports/pre-match/event-view/Soccer/World/18277589/qualificat%C3%B3rias-do-mundial-de-sele%C3%A7%C3%B5es-europa",
  SeguroBet: "https://www.seguro.bet.br/esportes/",
  Seubet: "https://www.seu.bet.br/ao-vivo/match",
  H2Bet: "https://www.h2.bet.br/esportes/match",
  MaximaBet: "https://www.maxima.bet.br/esportes",
  UltraBet: "https://ultra.bet.br/pb/sports/pre-match",
  SupremaBet: "https://suprema.bet.br/pb/sports/pre-match",
  BravoBet: "https://www.bravo.bet.br/esportes",
  BetPark: "https://www.betpark.bet.br/pb/sports",

  // Casas de apostas que estavam faltando no mapeamento
  "BetBra Exchange": "https://betbra.bet.br/",
  "Bet-Bra": "https://betbra.bet.br/",
  Betway: "https://betway.com/pt-br/",
  "Betway Brasil": "https://betway.com/pt-br/",
  BolsaDeApostas: "https://bolsadeaposta.com/",
  "Bolsa de Aposta": "https://bolsadeaposta.com/",
  FulltBet: "https://fulltbet.com/",
  FullTBet: "https://fulltbet.com/",
  Matchbook: "https://www.matchbook.com/",

  // Aliases para compatibilidade
  Bet365: "https://www.bet365.bet.br/",
  Betano: "https://www.betano.bet.br/",
  Betsson: "https://www.betsson.com/",
  Blaze: "https://blaze.bet.br/",
  Estrelabet: "https://www.estrelabet.bet.br/",
  Kto: "https://www.kto.bet.br/",
  Novibet: "https://www.novibet.bet.br/",
  Pinnacle: "https://www.pinnacle.com/",
  Sportingbet: "https://www.sportingbet.bet.br/",
  Superbet: "https://superbet.bet.br/",
  Rivalo: "https://www.rivalo.bet.br/",
};

// URLs especÃ­ficas para jogos live (diferentes das pre-match)
export const bookmakerLiveUrls = {
  Betboo: "https://www.betboo.bet.br/pt-br/sports/ao-vivo/aposta",
  TivoBet: "https://tivo.bet.br/br/sportsbook/live",
  Faz1Bet: "https://faz1.bet.br/br/sportsbook/live#/live/overview",
  JonBet: "https://jonbet.bet.br/pt/sports?bt-path=%2Flive",
};

/**
 * ObtÃ©m a URL correta para uma casa de apostas
 * Prioriza nosso mapeamento interno em vez dos campos anchorh1/anchorh2 da API
 * @param {string} house - Nome da casa de apostas retornado pela API
 * @param {boolean} isLive - Se Ã© um jogo live ou prÃ©-match
 * @param {string} anchorh1 - Campo anchorh1 da API (opcional, usado como fallback)
 * @param {string} anchorh2 - Campo anchorh2 da API (opcional, usado como fallback)
 * @returns {string} URL da casa de apostas
 */
export function getBookmakerUrl(
  house,
  isLive = false,
  anchorh1 = null,
  anchorh2 = null
) {
  if (!house) {
    console.warn("Casa de apostas nÃ£o informada");
    return "#";
  }

  // 1. PRIORIDADE: Tenta encontrar URL especÃ­fica para live se aplicÃ¡vel
  if (isLive && bookmakerLiveUrls[house]) {
    console.log(
      `ğŸ”´ URL Live encontrada para ${house}:`,
      bookmakerLiveUrls[house]
    );
    return bookmakerLiveUrls[house];
  }

  // 2. PRIORIDADE: Busca URL padrÃ£o no nosso mapeamento
  const url = bookmakerUrls[house];
  if (url) {
    console.log(`ğŸ  URL encontrada no mapeamento para ${house}:`, url);
    return url;
  }

  // 3. FALLBACK: Tenta variaÃ§Ãµes especÃ­ficas do nome no nosso mapeamento
  const variations = [
    house.toLowerCase(),
    house.toUpperCase(),
    house.replace(/\s+/g, ""),
    house.replace(/\..*$/, ""), // Remove extensÃµes como .bet.br
    house.split(".")[0], // Pega apenas a primeira parte antes do ponto
  ];

  for (const variation of variations) {
    // Busca exata apenas
    const exactMatch = bookmakerUrls[variation];
    if (exactMatch) {
      console.log(
        `ğŸ” URL encontrada por busca exata ${variation}:`,
        exactMatch
      );
      return exactMatch;
    }
  }

  // 4. FALLBACK: Tenta extrair URL dos campos anchorh da API
  const anchorhUrl = anchorh1 || anchorh2;
  if (anchorhUrl && typeof anchorhUrl === "string") {
    const extractedUrl = extractUrlFromAnchorh(anchorhUrl);
    if (extractedUrl) {
      console.log(`ğŸ”— URL extraÃ­da de anchorh para ${house}:`, extractedUrl);
      return extractedUrl;
    }
  }

  console.warn(
    `âš ï¸ URL nÃ£o encontrada para casa: "${house}". Usando URL genÃ©rica.`
  );
  return `https://www.google.com/search?q=${encodeURIComponent(
    house + " apostas esportivas"
  )}`;
}

/**
 * Adiciona ou atualiza uma URL de casa de apostas dinamicamente
 * @param {string} house - Nome da casa de apostas
 * @param {string} url - URL da casa de apostas
 * @param {boolean} isLive - Se Ã© uma URL especÃ­fica para live
 */
export function addBookmakerUrl(house, url, isLive = false) {
  if (isLive) {
    bookmakerLiveUrls[house] = url;
    console.log(`â• URL Live adicionada para ${house}:`, url);
  } else {
    bookmakerUrls[house] = url;
    console.log(`â• URL adicionada para ${house}:`, url);
  }
}

/**
 * Lista todas as casas de apostas com URLs cadastradas
 * @returns {Array} Array com nomes das casas de apostas
 */
export function getAvailableBookmakers() {
  return Object.keys(bookmakerUrls).sort();
}

/**
 * Extrai URL completa de um campo anchorh da API
 * @param {string} anchorh - Valor do campo anchorh1 ou anchorh2
 * @returns {string|null} URL extraÃ­da ou null se nÃ£o for possÃ­vel extrair
 */
export function extractUrlFromAnchorh(anchorh) {
  if (!anchorh || typeof anchorh !== "string") {
    return null;
  }

  try {
    // Busca por uma URL completa no campo anchorh
    const urlMatch = anchorh.match(/https?:\/\/[^\s&]+/);
    if (urlMatch && urlMatch[0]) {
      const url = urlMatch[0];
      console.log(`ğŸ”— URL extraÃ­da de anchorh:`, url);
      return url;
    }

    // Busca pelo parÃ¢metro domain= na URL
    const domainMatch = anchorh.match(/domain=([^&]+)/);
    if (domainMatch && domainMatch[1]) {
      const domain = domainMatch[1];
      const url = `https://${domain}`;
      console.log(`ğŸŒ URL construÃ­da a partir do domÃ­nio:`, url);
      return url;
    }

    console.warn(`âš ï¸ NÃ£o foi possÃ­vel extrair URL de:`, anchorh);
    return null;
  } catch (error) {
    console.error(`âŒ Erro ao extrair URL de anchorh:`, error);
    return null;
  }
}

/**
 * Extrai o domÃ­nio de um campo anchorh da API
 * @param {string} anchorh - Valor do campo anchorh1 ou anchorh2
 * @returns {string|null} DomÃ­nio extraÃ­do ou null se nÃ£o for possÃ­vel extrair
 */
export function extractDomainFromAnchorh(anchorh) {
  if (!anchorh || typeof anchorh !== "string") {
    return null;
  }

  try {
    // Busca pelo parÃ¢metro domain= na URL
    const domainMatch = anchorh.match(/domain=([^&]+)/);
    if (domainMatch && domainMatch[1]) {
      const domain = domainMatch[1];
      console.log(`ğŸ”— DomÃ­nio extraÃ­do de anchorh:`, domain);
      return domain;
    }

    // Se nÃ£o encontrar domain=, tenta extrair o domÃ­nio da URL completa
    const urlMatch = anchorh.match(/https?:\/\/([^\/\?&]+)/);
    if (urlMatch && urlMatch[1]) {
      const domain = urlMatch[1];
      console.log(`ğŸŒ DomÃ­nio extraÃ­do da URL:`, domain);
      return domain;
    }

    console.warn(`âš ï¸ NÃ£o foi possÃ­vel extrair domÃ­nio de:`, anchorh);
    return null;
  } catch (error) {
    console.error(`âŒ Erro ao extrair domÃ­nio de anchorh:`, error);
    return null;
  }
}

/**
 * ConstrÃ³i a URL completa para uma casa de apostas baseada no domÃ­nio extraÃ­do
 * @param {string} domain - DomÃ­nio extraÃ­do do anchorh
 * @param {boolean} isLive - Se Ã© um jogo live
 * @returns {string} URL completa para a casa de apostas
 */
export function buildBookmakerUrlFromDomain(domain, isLive = false) {
  if (!domain) {
    return null;
  }

  // Adiciona protocolo se nÃ£o tiver
  let url = domain.startsWith("http") ? domain : `https://${domain}`;

  // Se Ã© live, tenta adicionar parÃ¢metros especÃ­ficos para jogos ao vivo
  if (isLive) {
    // Adiciona parÃ¢metros comuns para jogos live
    const liveParams = ["/live", "/ao-vivo", "/in-play", "/live-betting"];
    const hasLiveParam = liveParams.some((param) => url.includes(param));

    if (!hasLiveParam) {
      // Adiciona o primeiro parÃ¢metro live disponÃ­vel
      url = url.endsWith("/") ? url + "live" : url + "/live";
    }
  }

  console.log(`ğŸ—ï¸ URL construÃ­da para domÃ­nio ${domain}:`, url);
  return url;
}
