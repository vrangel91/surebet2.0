<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste da P√°gina de Ranking</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #333;
        }
        .test-button {
            background: #00ff88;
            color: #1a1a1a;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        .test-button:hover {
            background: #00cc6a;
        }
        .test-button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .results {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #00ff88; }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        .info { color: #00aaff; }
    </style>
</head>
<body>
    <h1>üß™ Teste da P√°gina de Ranking</h1>
    
    <div class="test-section">
        <h2>üìä Testes de Dados</h2>
        <button class="test-button" onclick="testDataStructure()">Testar Estrutura de Dados</button>
        <button class="test-button" onclick="testBookmakerProcessing()">Testar Processamento de Bookmakers</button>
        <button class="test-button" onclick="testStatistics()">Testar C√°lculo de Estat√≠sticas</button>
        <div id="data-results" class="results"></div>
    </div>
    
    <div class="test-section">
        <h2>üåê Testes da API</h2>
        <button class="test-button" onclick="testAPIConnectivity()">Testar Conectividade</button>
        <button class="test-button" onclick="testAPIEndpoint()">Testar Endpoint</button>
        <button class="test-button" onclick="testAPITimeout()">Testar Timeout</button>
        <div id="api-results" class="results"></div>
    </div>
    
    <div class="test-section">
        <h2>üìã Testes da P√°gina</h2>
        <button class="test-button" onclick="testPageElements()">Testar Elementos da P√°gina</button>
        <button class="test-button" onclick="testCharts()">Testar Gr√°ficos</button>
        <button class="test-button" onclick="testResponsiveness()">Testar Responsividade</button>
        <div id="page-results" class="results"></div>
    </div>
    
    <div class="test-section">
        <h2>üöÄ Testes Completos</h2>
        <button class="test-button" onclick="runAllTests()">Executar Todos os Testes</button>
        <button class="test-button" onclick="generateReport()">Gerar Relat√≥rio</button>
        <div id="complete-results" class="results"></div>
    </div>

    <script>
        // Dados de teste
        const testSurebets = [
            {
                id: 'test_001',
                bookmaker1: 'Bet365',
                bookmaker2: 'William Hill',
                profit: 15.50,
                roi: 3.2,
                createdAt: '2024-01-15T10:00:00Z'
            },
            {
                id: 'test_002',
                bookmaker1: 'Bet365',
                bookmaker2: 'Unibet',
                profit: 12.80,
                roi: 2.8,
                createdAt: '2024-01-14T15:30:00Z'
            },
            {
                id: 'test_003',
                bookmaker1: 'William Hill',
                bookmaker2: 'Betfair',
                profit: 18.20,
                roi: 4.1,
                createdAt: '2024-01-13T09:15:00Z'
            }
        ];

        // Fun√ß√µes de teste
        function logResults(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            element.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            element.scrollTop = element.scrollHeight;
        }

        function testDataStructure() {
            const results = document.getElementById('data-results');
            results.innerHTML = '';
            
            logResults('data-results', 'üß™ Testando estrutura de dados...', 'info');
            
            try {
                // Verificar se os dados t√™m a estrutura correta
                const requiredFields = ['id', 'bookmaker1', 'profit', 'roi', 'createdAt'];
                let isValid = true;
                
                testSurebets.forEach((surebet, index) => {
                    const missingFields = requiredFields.filter(field => !surebet.hasOwnProperty(field));
                    if (missingFields.length > 0) {
                        logResults('data-results', `‚ùå Surebet ${index + 1} est√° faltando campos: ${missingFields.join(', ')}`, 'error');
                        isValid = false;
                    }
                });
                
                if (isValid) {
                    logResults('data-results', '‚úÖ Estrutura de dados √© v√°lida', 'success');
                    logResults('data-results', `üìä Total de surebets: ${testSurebets.length}`, 'info');
                }
                
            } catch (error) {
                logResults('data-results', `‚ùå Erro ao testar estrutura: ${error.message}`, 'error');
            }
        }

        function testBookmakerProcessing() {
            const results = document.getElementById('data-results');
            results.innerHTML = '';
            
            logResults('data-results', 'üîÑ Testando processamento de bookmakers...', 'info');
            
            try {
                const bookmakerStats = {};
                
                testSurebets.forEach(surebet => {
                    // Processar bookmaker1
                    if (surebet.bookmaker1) {
                        const bookmaker = surebet.bookmaker1.trim();
                        if (bookmaker) {
                            if (!bookmakerStats[bookmaker]) {
                                bookmakerStats[bookmaker] = {
                                    name: bookmaker,
                                    count: 0,
                                    totalProfit: 0,
                                    totalROI: 0
                                };
                            }
                            
                            bookmakerStats[bookmaker].count++;
                            bookmakerStats[bookmaker].totalProfit += surebet.profit || 0;
                            bookmakerStats[bookmaker].totalROI += surebet.roi || 0;
                        }
                    }
                    
                    // Processar bookmaker2
                    if (surebet.bookmaker2 && surebet.bookmaker2.trim()) {
                        const bookmaker = surebet.bookmaker2.trim();
                        if (bookmaker) {
                            if (!bookmakerStats[bookmaker]) {
                                bookmakerStats[bookmaker] = {
                                    name: bookmaker,
                                    count: 0,
                                    totalProfit: 0,
                                    totalROI: 0
                                };
                            }
                            
                            bookmakerStats[bookmaker].count++;
                            bookmakerStats[bookmaker].totalProfit += surebet.profit || 0;
                            bookmakerStats[bookmaker].totalROI += surebet.roi || 0;
                        }
                    }
                });
                
                // Calcular m√©dias
                Object.values(bookmakerStats).forEach(stats => {
                    stats.averageROI = stats.count > 0 ? stats.totalROI / stats.count : 0;
                    stats.averageProfit = stats.count > 0 ? stats.totalProfit / stats.count : 0;
                });
                
                logResults('data-results', '‚úÖ Processamento de bookmakers conclu√≠do', 'success');
                logResults('data-results', `üìä Bookmakers encontrados: ${Object.keys(bookmakerStats).length}`, 'info');
                
                Object.entries(bookmakerStats).forEach(([name, stats]) => {
                    logResults('data-results', `üèÜ ${name}: ${stats.count} surebets, ROI m√©dio: ${stats.averageROI.toFixed(2)}%, Lucro m√©dio: ${stats.averageProfit.toFixed(2)}`, 'info');
                });
                
            } catch (error) {
                logResults('data-results', `‚ùå Erro ao processar bookmakers: ${error.message}`, 'error');
            }
        }

        function testStatistics() {
            const results = document.getElementById('data-results');
            results.innerHTML = '';
            
            logResults('data-results', 'üìà Testando c√°lculo de estat√≠sticas...', 'info');
            
            try {
                const totalSurebets = testSurebets.length;
                const totalProfit = testSurebets.reduce((sum, s) => sum + (s.profit || 0), 0);
                const averageROI = testSurebets.reduce((sum, s) => sum + (s.roi || 0), 0) / totalSurebets;
                
                logResults('data-results', '‚úÖ Estat√≠sticas calculadas com sucesso', 'success');
                logResults('data-results', `üìä Total de surebets: ${totalSurebets}`, 'info');
                logResults('data-results', `üí∞ Lucro total: ${totalProfit.toFixed(2)}`, 'info');
                logResults('data-results', `üìà ROI m√©dio: ${averageROI.toFixed(2)}%`, 'info');
                
            } catch (error) {
                logResults('data-results', `‚ùå Erro ao calcular estat√≠sticas: ${error.message}`, 'error');
            }
        }

        async function testAPIConnectivity() {
            const results = document.getElementById('api-results');
            results.innerHTML = '';
            
            logResults('api-results', 'üåê Testando conectividade com a API...', 'info');
            
            try {
                const response = await fetch('https://zerolossbet.com/api/fetch_surebets/', {
                    method: 'HEAD',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    logResults('api-results', '‚úÖ API est√° respondendo', 'success');
                    logResults('api-results', `üì° Status: ${response.status}`, 'info');
                } else {
                    logResults('api-results', `‚ö†Ô∏è API respondeu com status: ${response.status}`, 'warning');
                }
                
            } catch (error) {
                logResults('api-results', `‚ùå Erro de conectividade: ${error.message}`, 'error');
                logResults('api-results', 'üí° Verifique se a API est√° online e se n√£o h√° problemas de CORS', 'info');
            }
        }

        async function testAPIEndpoint() {
            const results = document.getElementById('api-results');
            results.innerHTML = '';
            
            logResults('api-results', 'üß™ Testando endpoint da API...', 'info');
            
            try {
                const response = await fetch('https://zerolossbet.com/api/fetch_surebets/', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    logResults('api-results', '‚úÖ Endpoint funcionando', 'success');
                    logResults('api-results', `üìä Dados recebidos: ${Object.keys(data).length} surebets`, 'info');
                    
                    // Verificar estrutura dos dados
                    if (data && typeof data === 'object') {
                        logResults('api-results', '‚úÖ Estrutura de dados v√°lida', 'success');
                    } else {
                        logResults('api-results', '‚ö†Ô∏è Estrutura de dados inesperada', 'warning');
                    }
                    
                } else {
                    logResults('api-results', `‚ùå Endpoint retornou erro: ${response.status}`, 'error');
                }
                
            } catch (error) {
                logResults('api-results', `‚ùå Erro ao testar endpoint: ${error.message}`, 'error');
            }
        }

        async function testAPITimeout() {
            const results = document.getElementById('api-results');
            results.innerHTML = '';
            
            logResults('api-results', '‚è±Ô∏è Testando timeout da API...', 'info');
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 segundos
                
                const startTime = Date.now();
                
                const response = await fetch('https://zerolossbet.com/api/fetch_surebets/', {
                    method: 'GET',
                    mode: 'cors',
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                logResults('api-results', `‚úÖ API respondeu em ${responseTime}ms`, 'success');
                
                if (responseTime > 30000) {
                    logResults('api-results', '‚ö†Ô∏è API respondeu, mas demorou mais que 30 segundos', 'warning');
                }
                
            } catch (error) {
                if (error.name === 'AbortError') {
                    logResults('api-results', '‚è∞ API excedeu o timeout de 30 segundos', 'error');
                } else {
                    logResults('api-results', `‚ùå Erro durante teste de timeout: ${error.message}`, 'error');
                }
            }
        }

        function testPageElements() {
            const results = document.getElementById('page-results');
            results.innerHTML = '';
            
            logResults('page-results', 'üìã Testando elementos da p√°gina...', 'info');
            
            try {
                // Verificar se estamos na p√°gina de ranking
                const rankingContainer = document.querySelector('.ranking-container');
                if (!rankingContainer) {
                    logResults('page-results', '‚ùå P√°gina de ranking n√£o encontrada', 'error');
                    logResults('page-results', 'üí° Navegue para /ranking para executar este teste', 'info');
                    return;
                }
                
                logResults('page-results', '‚úÖ Container de ranking encontrado', 'success');
                
                // Verificar se√ß√µes principais
                const sections = [
                    { selector: '.stats-section', name: 'Se√ß√£o de Estat√≠sticas' },
                    { selector: '.ranking-table-section', name: 'Tabela de Ranking' },
                    { selector: '.chart-section', name: 'Se√ß√£o de Gr√°ficos' },
                    { selector: '.filters-section', name: 'Se√ß√£o de Filtros' }
                ];
                
                sections.forEach(section => {
                    const element = document.querySelector(section.selector);
                    if (element) {
                        logResults('page-results', `‚úÖ ${section.name} encontrada`, 'success');
                    } else {
                        logResults('page-results', `‚ùå ${section.name} n√£o encontrada`, 'error');
                    }
                });
                
            } catch (error) {
                logResults('page-results', `‚ùå Erro ao testar elementos: ${error.message}`, 'error');
            }
        }

        function testCharts() {
            const results = document.getElementById('page-results');
            results.innerHTML = '';
            
            logResults('page-results', 'üìä Testando gr√°ficos...', 'info');
            
            try {
                const charts = document.querySelectorAll('canvas');
                
                if (charts.length === 0) {
                    logResults('page-results', '‚ùå Nenhum gr√°fico encontrado', 'error');
                    return;
                }
                
                logResults('page-results', `‚úÖ ${charts.length} gr√°ficos encontrados`, 'success');
                
                charts.forEach((chart, index) => {
                    const ctx = chart.getContext('2d');
                    if (ctx) {
                        logResults('page-results', `‚úÖ Gr√°fico ${index + 1}: Contexto dispon√≠vel`, 'success');
                    } else {
                        logResults('page-results', `‚ùå Gr√°fico ${index + 1}: Contexto n√£o dispon√≠vel`, 'error');
                    }
                });
                
            } catch (error) {
                logResults('page-results', `‚ùå Erro ao testar gr√°ficos: ${error.message}`, 'error');
            }
        }

        function testResponsiveness() {
            const results = document.getElementById('page-results');
            results.innerHTML = '';
            
            logResults('page-results', 'üì± Testando responsividade...', 'info');
            
            try {
                const width = window.innerWidth;
                const isMobile = width <= 768;
                const isTablet = width <= 1200 && width > 768;
                
                logResults('page-results', `üì± Largura da tela: ${width}px`, 'info');
                logResults('page-results', `üì± Dispositivo: ${isMobile ? 'Mobile' : isTablet ? 'Tablet' : 'Desktop'}`, 'info');
                
                // Verificar se h√° estilos responsivos
                const mainContent = document.querySelector('.main-content');
                if (mainContent) {
                    const computedStyle = window.getComputedStyle(mainContent);
                    logResults('page-results', `üì± Flexbox: ${computedStyle.flexDirection}`, 'info');
                }
                
                logResults('page-results', '‚úÖ Teste de responsividade conclu√≠do', 'success');
                
            } catch (error) {
                logResults('page-results', `‚ùå Erro ao testar responsividade: ${error.message}`, 'error');
            }
        }

        async function runAllTests() {
            const results = document.getElementById('complete-results');
            results.innerHTML = '';
            
            logResults('complete-results', 'üöÄ Executando todos os testes...', 'info');
            
            try {
                // Testes de dados
                logResults('complete-results', 'üìä Executando testes de dados...', 'info');
                testDataStructure();
                testBookmakerProcessing();
                testStatistics();
                
                // Testes da API
                logResults('complete-results', 'üåê Executando testes da API...', 'info');
                await testAPIConnectivity();
                await testAPIEndpoint();
                await testAPITimeout();
                
                // Testes da p√°gina
                logResults('complete-results', 'üìã Executando testes da p√°gina...', 'info');
                testPageElements();
                testCharts();
                testResponsiveness();
                
                logResults('complete-results', 'üéâ Todos os testes foram executados!', 'success');
                logResults('complete-results', 'üí° Verifique os resultados de cada se√ß√£o acima', 'info');
                
            } catch (error) {
                logResults('complete-results', `‚ùå Erro durante execu√ß√£o dos testes: ${error.message}`, 'error');
            }
        }

        function generateReport() {
            const results = document.getElementById('complete-results');
            results.innerHTML = '';
            
            logResults('complete-results', 'üìÑ Gerando relat√≥rio de testes...', 'info');
            
            const report = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                screenSize: `${screen.width}x${screen.height}`,
                windowSize: `${window.innerWidth}x${window.innerHeight}`,
                url: window.location.href
            };
            
            logResults('complete-results', 'üìã Informa√ß√µes do Sistema:', 'info');
            logResults('complete-results', `üìÖ Data/Hora: ${new Date(report.timestamp).toLocaleString('pt-BR')}`, 'info');
            logResults('complete-results', `üåê URL: ${report.url}`, 'info');
            logResults('complete-results', `üì± Tela: ${report.screenSize}`, 'info');
            logResults('complete-results', `ü™ü Janela: ${report.windowSize}`, 'info');
            
            logResults('complete-results', '‚úÖ Relat√≥rio gerado com sucesso', 'success');
            logResults('complete-results', 'üí° Copie estas informa√ß√µes para o suporte t√©cnico se necess√°rio', 'info');
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            logResults('complete-results', 'üîß P√°gina de teste carregada com sucesso!', 'success');
            logResults('complete-results', 'üí° Use os bot√µes acima para executar diferentes tipos de teste', 'info');
        });
    </script>
</body>
</html>
